# EnderBit Hosting - Apache Configuration

# Custom Error Pages
ErrorDocument 404 /404.php
ErrorDocument 500 /500.php
ErrorDocument 403 /404.php
ErrorDocument 503 /500.php

RewriteEngine On

# Set default index file
DirectoryIndex index.php

# Redirect /index to / (root)
RewriteRule ^index/?$ / [L,R=301]

# Handle /image/IMAGE_ID URLs
RewriteRule ^image/([^/]+)$ image.php?id=$1 [L,QSA]

# Handle /ticket/TICKET-ID URLs
RewriteRule ^ticket/([^/]+)$ ticket.php?id=$1 [L,QSA]

# Remove .php extension from URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]

# Redirect .php URLs to extensionless URLs
RewriteCond %{THE_REQUEST} ^GET\ /([^\ ]+)\.php
RewriteRule ^ /%1 [L,R=301]

# Force trailing slash removal
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [L,R=301]

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Disable Directory Browsing
Options -Indexes

# Protect sensitive files
<FilesMatch "^(config\.php|tokens\.json|tickets\.json|settings\.json|.*\.log|version\.json)$">
    Require all denied
</FilesMatch>

# Protect backup directory
<DirectoryMatch "^.*/backups(/|$)">
    Require all denied
</DirectoryMatch>
